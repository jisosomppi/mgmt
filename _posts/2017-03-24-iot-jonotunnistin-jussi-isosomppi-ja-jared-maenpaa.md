---
ID: 27
post_title: >
  IoT-Jonotunnistin, Jussi Isosomppi ja
  Jared Mäenpää
author: jussi
post_excerpt: ""
layout: post
permalink: >
  http://jisosomppi.me/2017/03/24/iot-jonotunnistin-jussi-isosomppi-ja-jared-maenpaa/
published: true
post_date: 2017-03-24 10:52:29
---
<strong>Konseptimme</strong>

<img class="alignnone size-full wp-image-33" src="http://46.101.223.159/wp-content/uploads/2017/03/20170323_152143.jpg" alt="20170323_152143" width="4032" height="3024" />
Projektityönämme toteutimme järjestelmän, joka mahdollistaisi jonottavien ihmisten määrän sekä jonotusajan seurannan etänä. Tämä mahdollistaisi helpomman ennakoinnin sekä paremman vierailukokemuksen esim. huvipuistoissa. Järjestelmä perustuisi rannekkeisiin upotettuihin RFID-tunnisteisiin, jotka voitaisiin lukea jonotustilan varrelle sijoitetuilla tunnistinporteilla. <!--more-->Tämä seurantamenetelmä ei vaatisi asiakkailta mitään lisätoimia, sillä RFID-tunnisteiden lukuetäisyys ihanneoloissa on jopa 15 metriä. Tunnistinportteja sijoitettaisiin jokaisen laitteen yhteyteen sekä jonon alku-, että loppupäähän. Porttien havaintojen välissä kuluneen ajan keskiarvoa mittaamalla saataisiin arvioidut jonotusajat jokaiselle laitteelle.

Tunnistinporteista kerättyä, prosessoitua dataa voitaisiin toimittaa asiakkaiden tietoon puistossa olevien infotaulujen tai vaikkapa mobiiliapplikaation välityksellä. Täten asiakkaiden olisi helpompaa valita ruuhkattomat laitteet, joka tasoittaisi myös osaltaan puiston ruuhkahuippuja ja helpottaisi myös henkilökunnan sijoittelua. Järjestelmää voisi skaalata käytännössä loputtomiin laitteiden lukumäärää ja tiedon prosessointikapasiteettia kasvattamalla.

Järjestelmää olisi mahdollista skaalata myös alaspäin, tilanteisiin joissa tunnisteiden jakaminen ei ole kannattavaa tai mahdollista. Tällaisessa tilanteessa RFID-tunnisteiden tilalle voitaisiin ottaa käyttöön videokuvan tulkinta tai ultraääni/infrapunasensorit. Taustalla oleva toimintalogiikka pysyisi samalla, ja ainoastaan tunnistustapa muuttuisi.
<strong>Laajennus- ja integrointimahdollisuudet</strong>

Jononseurantajärjestelmään olisi mahdollista lisätä myös muita käteviä toimintoja, jotka edelleen parantaisivat vierailukokemusta sekä lisäisivät yritykselle mahdollisuuksia käyttää kerättyä dataa uusilla tavoilla. Näistä mahdollisuuksista suurimpana tulevat mieleen opettajankin ehdottama kanta-asiakkaille lähetetty tieto hiljaisemmista päivistä, joka olisi kiireiselle kävijälle arvokasta tietoa. Samaan yhteyteen voitaisiin lisätä mm. kanta-asiakkaille ”priority”-jonot, tai muita vastaavia etuja.

Rannekkeisiin upotetut RFID-tunnisteet mahdollistaisivat myös muita moderneja toimintoja huvipuistoon, kuten erilaisten lippuluokkien (esim. pituusrajan perusteella) tallentamisen suoraan rannekkeeseen tai käynnin aikana tehtyjen ostosten yhdistämisen rannekkeeseen ja maksamiseen kerralla lähtiessä. Tunnisteiden ansiosta voitaisiin nopeuttaa laitteiden lastaamista, kun kävijät voisivat tarkistuttaa lippunsa automaatilla, joka myös varmistaisi pääsyoikeuden kyseiseen laitteeseen. Periaatteessa tällöin lipuntarkastus poistuisi kokonaan henkilökunnan tehtävistä, joka taas mahdollistaisi tehokkaamman ajankäytön.

Rannekkeeseen upotettu RFID-tunniste mahdollistaisi myös oman lippuluokan ja lipun muiden tietojen tarkistamisen omalla älypuhelimella (NFC-luvulla varustetulla), tai muita, kehittyneempiä toimintoja lipun ja älypuhelinsovelluksen välillä.

<strong>Konseptin tarjoamat edut</strong>

Huvipuiston rannekkeessa RFID-tunniste

→ kustannustehokas, RFID-moduulit &lt;30snt/kpl
→ tunniste kulkee aina kävijän mukana
→ ei vaadi lataamista tai muuta vastaavaa ylläpitoa
→ portin läpi kulkevia tunnisteita voidaan tunnistaa satoja minuutissa
→ tarvittaessa voidaan valvoa tai tarkistaa suuriakin ihmismääriä käsikäyttöisellä lukijalla
→ pituusmittaukset lipunmyynnissä, laitteella riittää lippuun tallennetun arvon tarkistaminen
→ lipuntarkistuksen laitteilla voisi automatisoida kulunvalvontaporteilla
→ tunnistus mahdollistaisi myös automaattisen matkustajamäärän valvonnan
→ uudelleenkäytettävä

Laitteiden jonon alussa portti tai muu vastaava tunnistustapa, lopussa joko toinen samanlainen tai kosketustunnistus laitteeseen mennessä (vrt. matkakortti)

→ etäluettava ilman, että käyttäjän tarvitsee tehdä mitään
→ tunnistaa isot seurueet, vierekkäin sisään tulleet, jonosta taaksepäin poistuneet

Jonossa olevien ihmisten määrän selvitys

→ luotettava määrätieto
→ poistaa tarpeen kävijöiden laskemiseen henkilökunnalta (turvallisuusohjeet, tilastot)
→ helpottaa esim. työntekijöiden siirtämistä ruuhkaisiin kohteisiin

Aikaleimausten erotuksesta laskettu jonotusaika

→ helpottaa ongelmakohtien tunnistamista kohteen valvonnassa
→ luotettava tapa saada ajan tasalla olevaa, tarkkaa tietoa jonotusajoista
→ aikaleimoja on helppo käsitellä eri tarkoituksia varten

Jonon pituus + jonotusaika tietokantaan ja niiden seuranta etänä

→ esim. Koottuna tauluihin ympäri huvipuistoa, jonojen pituudet eri laitteisiin
→ jonotusajat selkeästi luettavaan muotoon laitelistauksen yhteyteen
→ aikojen esitys kartan yhteydessä esim. mobiiliapplikaation kautta

<strong>Tarkempaa tietoa toteutuksesta</strong>

Toteutetaan prototyyppi kytkemällä RFID-lukija (RFID-RC522) Arduinoon, joka lähettää saadun datan tietokoneelle. Näitä laitteita tehdään kaksi kappaletta, joka simuloi jonon eri päissä olevia tunnistinportteja. Laitteille ohjelmoidaan omat tunnisteet, joiden perusteella tietokannassa voidaan erottaa ne toisistaan. Tietokantaan välitettyihin rannekenumeroihin liitetään aina lukijan tunniste. Tämä mahdollistaa toteutuksen skaalaamisen suurempaan mittakaavaan, kun tiedetään, minkä laitteen tunnistinportista asiakas on kävellyt sisään tai ulos.

<strong>Datan käsittely</strong>

<img class="alignnone size-full wp-image-34" src="http://46.101.223.159/wp-content/uploads/2017/03/nacc88yttocc88kuva-2017-03-23-kello-15-22-19.png" alt="Näyttökuva 2017-03-23 kello 15.22.19" width="886" height="604" />
Tietokoneella pyörivä python-skripti (http://iot.botbook.com/) kerää saadut tunnistustiedot ja välittää ne palvelimelle. Palvelimella pyörivä omatekoinen node.js-skripti käsittelee saapuvat tunnistukset ja antaa niille aikaleiman. Tässä vaiheessa poistetaan kaikki toistuvat tunnistukset.

Käyttämämme laitteet toimittavat tietoa palvelimelle omilla tunnisteillaan, joka mahdollistaa jonon eri päiden erottamisen toisistaan. Palvelimella verrataan kunkin kävijän aikaleimauksia, joiden perusteella lasketaan keskimääräinen jonotusaika.

<strong>Kerätyn datan esittäminen</strong>

Valitsimme esimerkkitoteutukseemme huvipuiston kartan, jonka yhteydessä jonotusajat esitetään. Jonotusajat päivittyvät sivulle automaattisesti, joka osaltaan parantaa palvelun käytettävyyttä. Tähän interaktiiviseen karttaan voisi valmiissa tuotteessa lisätä kuvaukset laitteista, sekä mahdollistaa laitteiden rajauksen mm. pituusrajojen tai laitetyypin perusteella. Interaktiiviset infotaulut olisivat huvipuistossa luonteva paikka tällaiselle kartalle.

<strong>Odotetut ongelmatilanteet</strong>

Pelkkä sisäänleimaus
asiakas käy tasan portilla ja kääntyy ympäri
asiakas poistuu jonosta muaalta kuin portin kautta
asiakas ”katoaa” jonosta → moninkertainen jonotusaika

RFID-tagi havaitaan muualla
asiakas poistunut jonossa esim. ylläolevilla tavoilla

Jatkuvat sisäänleimaukset
asiakas jonottaa portin kohdalla → erotettava samaa kautta poistumisesta

Tunnistusvirheet
RFID-tunnistukset alttiita häiriöille
käytettävä vikasietoisia keskiarvoja

Ongelmatilanteet palvelimella
Palvelinkapasiteetin riittämättömyys
Virheet palvelimen koodissa
Tietoturvahaasteet

<strong>Projektin eteneminen</strong>

1. Todettu RFID-lukija toimivaksi komponentiksi, vaikkakin heikosti. Syynä huono kontakti, joka korjautunee juotosten myötä. Myös Arduinon toiminta tarkistettu.

2. RFID-tagien toiminta tarkistettu kahdella ohjelmalla: toinen lukee kortin koko sisällön, toinen luo 5-lukuisen tunnisteen. Käytössä neljä eri RFID-tunnistetta, joista kaikki luettu molemmilla Arduinoilla ja RFID-lukijoilla. Tunnisteet kirjattu ylös koodia varten.

3. Kahden erillisen laitteen kytkeminen ja tietojen vertaaminen hankalaa/mahdotonta BotBookin kautta, luodaan oma ohjelma. Oma skripti hoitaa aikaleimojen vertailun ja käsittelyn.

4. Lukijoiden liitännät juotettu. Molemmat lukijat testattu toimiviksi tarkistamalla jokaisen tagin tunniste kahdella eri tavalla. Tunnisteet ovat molemmilla laitteilla samoja noin 95% ajasta, mutta virhelukujakin tulee.

5. Projektia koitettu siirtää Arduinolta ESP8266-12E:lle heikoin tuloksin. ESP ei anna tarpeeksi virtaa, joten ulkoinen virtalähde olisi pakollinen. Tyydymme ajan puutteen takia Arduinoon. Myös lopullinen toteutus olisi kytketty kaapelilla, jotta tarve lataamiselle tai akkujen vaihtamiselle poistuisi.

6. Palvelulle kehitetty front- ja backendiä. Malliksi valittu Tykkimäen huvipuistokartta, jonka yhteyteen jonotusaika päivittyy reaaliajassa. Tykkimäen kartta on kotimaisista huvipuistoista selkein, ja mahdollistaa parhaiten näkemyksemme palvelun toiminnasta.

7. Hiottu jonotusajan laskentatapaa. Lisätty loogisia raja-arvoja, joilla käsitellään jonosta ”kadonneita” asiakkaita (poistetaan asiakas jonosta, jos ollut jonossa 30min tuoreinta keskiarvoa pidempään).

<strong>Liitteet / referenssit</strong>

Projekti toteutettiin Tero Karvisen (<a href="http://terokarvinen.com">http://terokarvinen.com</a>) vetämällä IoT-työpajakurssilla Haaga-Helia ammattikorkeakoulussa 20.-24.03.2017. Projekti toteutettiin kokonaisuudessaan viikon aikana.

Kaikki käytetyt komponentit ovat Haaga-Helian tai opettajan lainaamia.

Arduinolta dataa sieppaava Python-skripti <a href="http://iot.botbook.com">http://iot.botbook.com</a>

RFID-tunnisteiden tarkistus <a href="http://playground.arduino.cc/Learning/MFRC522">http://playground.arduino.cc/Learning/MFRC522</a>

Kortin tunnisteen luku ja käytetty RFID-kirjasto <a href="http://www.instructables.com/id/Arduino-RFID-Reader-MFRC522-Turorial/">http://www.instructables.com/id/Arduino-RFID-Reader-MFRC522-Turorial/</a>

Kytkentäkaavio <a href="https://youtu.be/23aMjljCLZI?t=42">https://youtu.be/23aMjljCLZI?t=42</a>

Dokumentaation <a title="IoT-projekti jonotunnistin" href="http://46.101.223.159/wp-content/uploads/2017/03/iot-projekti-jonotunnistin.pdf">PDF-versioon tästä</a>

Työparin mietteet ja palvelimen lähdekoodit <a href="https://jaredmaenpaa.wordpress.com/2017/03/23/iot-tyopaja/">täältä.</a>

<img class="alignnone size-full wp-image-36" src="http://46.101.223.159/wp-content/uploads/2017/03/kytkentc3a4.png" alt="kytkentä" width="1280" height="720" />
Tunnisteiden tiedot (rfid2):            Tunnisteiden tiedot (rfid1):

Card UID: 20 F2 67 4D                70,176,208,160,134
Card UID: 56 19 02 9E                4,245,13,70,186
Card UID: 46 B0 D0 A0                32,242,103,77,248
Card UID: 04 F5 0D 46                86,25,2,158,211